#! /bin/sh
#
# Test suite for basic runtests functionality.
#
# Copyright 2008, 2009 Russ Allbery <rra@stanford.edu>
#
# See LICENSE for licensing terms.

. "@abs_top_srcdir@/tap/libtap.sh"

# Run runtests on a list and compare the output to the expected output,
# printing ok if it matches.  Strip out the time information from the runtests
# result since it changes for each run.
ok_runtests () {
    ../../runtests "$1".list | sed 's/\(Tests=[0-9]*\),  .*/\1/' > "$1".result
    diff -u "$1".out "$1".result 2>&1
    status=$?
    ok [ $status -eq 0 ]
    if [ $status -eq 0 ] ; then
        rm "$1".result
    fi
    rm -f core
}

# Find where our test cases are.
for dir in ./tests/basic . ./basic ; do
    [ -f $dir/pass.list ] && cd $dir
done

# Total tests.
plan 5

# First run the tests expected to succeed.
ok_runtests pass
ok_runtests skip
ok_runtests fail
ok_runtests abort
ok_runtests abort-one
