# $Id$

CC		= @CC@
CFLAGS		= @CFLAGS@
CPPFLAGS	= @CPPFLAGS@
LDFLAGS		= @LDFLAGS@

srcdir		= @srcdir@
VPATH		= @srcdir@

RANLIB		= @RANLIB@

OBJS		= concat.o error.o xmalloc.o xwrite.o

WARNINGS	= -ansi -pedantic -Wall -W -Wunused -Wshadow \
		  -Wpointer-arith -Wbad-function-cast -Wcast-qual \
		  -Wcast-align -Wwrite-strings -Wstrict-prototypes

all: librutil.a

librutil.a: $(OBJS)
	ar rv $@ $(OBJS)
	$(RANLIB) $@

.c.o: $*.c
	$(CC) $(CFLAGS) -I$(srcdir) $(CPPFLAGS) -c $*.c -o $@

runtests: runtests.o librutil.a
	$(CC) -o $@ runtests.o librutil.a $(LDFLAGS) $(LIBS)

t/concat.t: t/concat-t.o librutil.a
	$(CC) -o $@ t/concat-t.o librutil.a $(LDFLAGS) $(LIBS)

t/error.t: t/error-t.o librutil.a
	$(CC) -o $@ t/error-t.o librutil.a $(LDFLAGS) $(LIBS)

t/xmalloc: t/xmalloc.o librutil.a
	$(CC) -o $@ t/xmalloc.o librutil.a $(LDFLAGS) $(LIBS)

t/xwrite.t: t/xwrite-t.o t/fakewrite.o librutil.a
	$(CC) -o $@ t/xwrite-t.o t/fakewrite.o librutil.a $(LDFLAGS) $(LIBS)

check test: runtests t/concat.t t/error.t t/xmalloc t/xwrite.t
	./runtests t/TESTS

clean:
	rm -f *.o t/*.o librutil.a runtests t/concat.t t/error.t t/xmalloc
	rm -f t/xwrite.t

distclean: clean
	rm -f Makefile config.cache config.h config.log config.status
